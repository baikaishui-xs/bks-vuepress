---
title: webpack 介绍
date: 2022-06-27 13:42:15
permalink: /pages/208ef4/
categories:
  - 《前端》笔记《其它》
  - webpack
tags:
  - 
---
作用：它提供了友好的前端模块化开发支持，以及代码压缩混淆、不用考虑浏览器兼容问题，内部会自动转换成兼容代码、性能优化等强大的功能
    - CSS 高级代码不会转换成兼容代码，但是 CSS 高级代码在低版本浏览器中虽然不能运行，但是并不会报错
优点：让程序员把工作的重心放到具体功能的实现上，提高了前端开发效率和项目的可维护性。

提示：使用 vue-cli 可以快速搭建 webpack，详见 知识点：vue-cli

特性：由于 webpack 是基于 node.js 开发出来的打包工具，因此在它的配置文件中，支持使用 node.js 相关语法

可以解决以下报错：
    Uncaught SyntaxError: Cannot use import statement outside a module
    解：该语法有兼容性问题，无法识别。webpack 可以将不兼容的语法，转换成兼容语法

搭建项目：
    （1）新建用个项目，输入 npm init -y 生成 package.json
    （2）创建 src 目录，用于存放程序员写的源代码

下载：npm install webpack@5.42.1 webpack-cli@4.7.2 -D

开发环境
  - 命令：npm run dev
  - 特性：不打包项目

生产环境
  - npm run build
  - 特性：打包项目。将文件打包成 html + js + css

提示：配置以下操作后，要重新打包，才会生效
配置 webpack：

    （1）在项目根目录创建 webpack.config.js 配置文件，并添加以下配置项
        module.exports = {
            // 指定构件模式：development（开发模式：不会 对打包生成的文件进行 代码压缩 和 性能优化，打包速度快）production（生产模式：会 对打包生成的文件进行 代码压缩 和 性能优化，打包速度慢）
            mode: 'development'  
        }

    （2）在 package.json 的 scripts 配置项下，新增 dev 脚本如下：
        "scripts": { // 注册脚本，通过 npm run dev 脚本名 执行脚本
            "dev": "webpack"
        }

    （3）运行 npm run dev 命令，启动 webpack 进行项目的打包构建
        - 会自动在项目根目录生成 dist 目录 和 main.js 文件

压缩 main.js 中的代码（压缩后的代码没有 空格 和 注释：
    1、把构件模式改为 production
    2、运行 npm run dev 命令

默认约定：
    默认打包 入口文件 路径  src/index.js
    默认输出 入口文件 路径  dist/main.js

    -- webpack.config.js
        修改默认打包 入口文件 路径：
            1、导入 const path = require('path')
            2、在 module.exports 里添加以下配置项
                // entry：指定打包 入口 文件路径
                entry: path.join(__dirname, './src/index.js')

        修改默认输出入口文件 路径 和 名字：
            // 将 dist/main.js 改为 bundle.js
            // 将 main.js 改为 bundle.js
            1、在 module.exports 里添加以下配置项
                // output：指定打包 出口 文件
                output: {
                    path: path.join(__dirname, './dist'),  // 入口文件的存放目录
                    filename: 'bundle.js'  // 输出入口文件路径
                }

插件：
    （1）webpack-dev-server：
        作用：每保存一次入口文件，就自动执行 npm run dev 命令，并自动刷新浏览器
        下载：npm install webpack-dev-server@3.11.2 -D
        配置：
            在 package.json → scripts → dev 中添加 serve，如下
            "scripts": { // 注册脚本，通过 npm run dev 脚本名 执行脚本
                "dev": "webpack serve"  // server 作用：将生成的文件放到内存中
            }
        使用步骤：
            1、引入项目根目录中的 main.js 到 index.html 中（不能引入 dist/bundle.js，因为进入监听状态后，每次保存操作修改的是内存中的入口文件，不是 dist/bundle.js 的入口文件，这个入口文件在项目根目录是看不到的，webpack-dev-server 把它放到了内存中，因为内存要比物理磁盘的读写速度更快，这样可以更快速的进行读写操作）（输入 npm run dev 后的提示信息也会显示入口文件的所在目录 如：webpack output is served from /，即目录在根目录下）
            <script src="/main.js"><script>

            2、输入 npm run dev 命令后进入监听状态

        注意：使用这个插件后，无论是否开启监听状态，只能通过 http协议 访问页面，才能看到修改后的效果，通过本地的 index.html 是无法看到修改后的效果的，因为本地访问的是 file协议
        提示：项目运行在 http://loaclhost:8080 中

    （2）html-webpack-plugin
        作用：
            1、打开 http://loaclhost:8080 就渲染 index.html
            2、在生成的 index.html 中自动引入 入口文件（可以在项目所在服务器，右键查看原代码中查看）
        下载：npm install html-webpack-plugin@5.3.2 -D

        配置：

            在 webpack.config.js 中完成以下步骤

            1、导入插件，得到构造函数
                const HtmlPlugin = require('html-webpack-plugin')

            2、创建实例对象
                const htmlPlugin = new HtmlPlugin({ 
                    template: './src/index.html',  // 指定 原 文件的存放路径
                    filename: './index.html',      // 指定 生成 文件的存放路径（为了更快速的进行读写操作，这个文件是在内存中的，在物理磁盘中无法看见）
                })

            3、在 module.exports 添加以下代码
                plugins: [htmlPlugin],

    （3）clean-webpack-plugin
        作用：打包前自动删除 dist 文件
        下载：npm install --save-dev clean-webpack-plugin
        配置 webpack.config.js
                1、添加 const { CleanWebpackPlugin } = require('clean-webpack-plugin');
                2、添加 const cleanPlugin = new CleanWebpack-plugin')
                2、在 plugins 配置项中添加：
                    plugins: [cleanPlugin)]
        测试：在 dist 目录中新建一个 123.txt，然后执行 npm run build 命令，如果 123.txt 不存在，则代表配置成功

devServer 配置项
    作用：
        1、输入 npm run dev 命令后自访问指定 IP 地址
        2、指定 默认端口号
        3、指定 IP 地址
    使用步骤：
        在 webpack.config.js 中的 devServer 配置项 中完成以下步骤

        添加：open: true  // 输入 npm run dev 命令后自动访问指定 IP 地址

        添加：port: 80  // 指定 默认端口号

        添加：host: '127.0.0.1'  // 指定 IP 地址

loader（加载器）
    作用：解决 webpack 只能打包 js 文件,不能打包其它文件的的情况

    （1）打包处理 CSS 文件
        下载：npm i style-loader@3.0.0 css-loader@5.2.6 -D

        使用步骤：

            1、CSS 的导入放在 index.html 入口文件中
                如：import './css/index.css
        
            2、配置 webpack.config.js
                在 module 配置项中添加：
                module: {  // 所有第三方文件模块的匹配规则
                    rules: [  // test：文件后缀名的匹配规则  use：调用的 loader
                            // loader 的执行机制：当 webpack 无法处理时，会从后面往前查找匹配的 loader，所以 loader 的执行顺序要写正确
                                // 如：先匹配 css-loader 再匹配 style-loader
                        { test: /\.css$/, use: ['style-loader', 'css-loader'] },
                    ]
                }
            
    （2）打包处理 less 文件
        下载：npm i less-loader@10.0.1 less@4.1.1 -D
        注意：打包处理 less 文件依赖打包处理 css 文件，请先下载和配置打包处理 css 文件

        使用步骤：

            1、less 的导入放在 index.html 入口文件中
                如：import './css/index.less
        
            2、配置 webpack.config.js
                在 module 配置项中添加：
                module: {  // 所有第三方文件模块的匹配规则
                    rules: [  // test：文件后缀名的匹配规则  use：调用的 loader
                        { test: /\.css$/, use: ['style-loader', 'css-loader'] },
                        { test: /\.less$/, use: ['style-loader', 'css-loader', 'less-loader'] },
                    ]
                }

    （3）打包处理 图片 文件
        扩展知识：
            base64 图片解析技术：
            网站：https://base64.us/#
            作用：提高浏览器性能：浏览器加载图片时，无需向服务端发送请求，和精灵图的作用一样
            缺点：增加该编码所在文件的的体积，所以不推荐解析大图片
            适用：小图片
            如：<img src="输入编码后的字符串">

        下载：npm i url-loader@4.1.1 file-loader@6.2.0 -D
        作用：将图片解析成 base64，并存放在 src 属性中
        配置： webpack.config.js
            在 module 配置项中添加：
                module: {  // 所有第三方文件模块的匹配规则
                    rules: [  // test：文件后缀名的匹配规则  use：调用的 loader
                        {
                            test: /\.jpg|png|gif$/, 
                            use: {
                                loader: 'url-loader',
                                options: {
                                    limit: 22229,  // limit：只有小于指定文件大小（单位为字节），才会转换为 base64
                                },
                            }
                        },
                    ]
                }
        使用步骤：
            1、在模块入口文件中导入要使用的 图片路径
                import log from 'images/logo.jpg'
            2、动态设置 图片路径
                $('.box').attr('src', logo)
            
    （4）打包处理 JS 高级语法
        下载：npm i babel-loader@8.2.2 @babel/core@7.14.6 @babel/plugin-proposal-decorators@7.14.5 -D
        作用：JS编译器，可以将高级语法转换为浏览器兼容的语法，webpack 只能转换一部分的 JS 高级语法，babel-loader 可以解决 webpack 无法处理的高级语法
        官网：https://www.babeljs.cn
        配置： webpack.config.js
            1、在 module 配置项中添加：
                module: {  // 所有第三方文件模块的匹配规则
                    rules: [ 
                        {
                             // test：文件后缀名的匹配规则    use：调用的 loader    
                            test: /\.js$/, use: 'babel-loader',

                            // exclude：指定不需要打包的 文件/目录（只需要转换自己写的代码即可，第三方包的代码不需要转换）
                            exclude: /node_modules/

                            use: {
                                loader: 'babel-loader',
                                otions: {
                                    plugins: ['@babel/plugin-proposal-class-properties']
                                }
                            }
                        },
                    ]
                }
            2、在项目根目录下，创建名为 babel.config.js 的配置文件，并添加以下代码：
                module.exports = {
                    plugins: [['@babel/plugin-proposal-decorators', { legacy: true }]]
                }

整理 dist 目录下的文件，放到指定目录中
    （1）将 JS文件 放到 JS目录 中
        使用步骤：在 webpack.config.js 的 output 配置项里的 filename 路径前面加上 js/
            如：
                output: {
                    filename: 'js/bundle.js'
                }

    （2）将 图片文件 放到 imgage目录 中
        使用步骤：在 webpack.config.js 的 打包处理图片文件loader中的 options 中添加 outputPath=images
            如：
                options: {
                    outputPath=image,
                }

Source Map 文件
    作用：代码报错时，让控制台显示 压缩前 的报错行号，而不是显示 压缩后 报错行号。点击报错文件时，显示的也是压缩前的原文件

    开发环境下使用的方案：
        作用：让运行时报错的行数与源代码的行数保持一致
        配置： webpack.config.js
            在 module.exports 配置项中添加：devtool: 'eval-source-map',  // 不压缩原文件
            
        注意：在生产环境下出于安全问题，需要关闭 Source Map，防止原代码暴露
            关闭方法：删除 devtool 配置项

    生产环境下使用的方案：
        作用：在生产环境下，既不暴露原代码，也可以定位报错代码的行号
        配置： webpack.config.js
            在 module.exports 配置项中添加：devtool: 'nosources-source-map',  // 压缩原文件

    生产环境下使用的方案（不推荐）：
        作用：在生产环境下，暴露原代码，且展示定位报错代码的行号
        注意：该方案会导致原代码暴露
        配置：： webpack.config.js
            在 module.exports 配置项中添加：devtool: 'source-map',  // 不压缩原文件
        特性：该方案会在打包后的 JS 目录下生成 bundle.js.map 文件，用于记录原代码的位置信息

打包
    作用：
        1、代码压缩、性能优化
        2、将内存中的文件存放到物理磁盘中
    
    配置 package.json
        // build 脚本的作用：打包项目    "webpack --mode production"：将 webpack.config.js 中的构建模式改为 生产模式
        在 scripts 配置项中添加："build": "webpack --mode production",

    打包命令：npm run build
    使用步骤：
        1、将构建模式改为 生产模式 下使用的方案
        2、将 Source Map 改为
    提示：将生成的 dist 目录，压缩成压缩包，发送给后端，让后端发布

@
    作用：解决 ../ 和 / 使用多次导致代码不美观的问题
    配置： webpack.config.js
        在 module 配置项的下面新增以下配置项：
            resolve: {
                alias: {
                // 告诉 webpack，程序员写的代码中，@ 符号表示 src 这一层目录
                '@': path.join(__dirname, './src/')
                }
            }
    语法：
       @/指定文件：从 src 目录中，查找指定文件
            传统方法：import mag from '../../../../mgs.js'
            @ 方法：import mag from '@/mgs.js'

企业级项目打包发布流程：
    提示：在后面的 vue 项目课中会进行讲解

    1、生成打包报告，根据报告分析具体的优化方案
    2、Tree-Shaking
    3、为第三方库启用 CDN 加载
    4、配置组件的按需加载
    5、开启路由懒加载
    6、自定制首页内容