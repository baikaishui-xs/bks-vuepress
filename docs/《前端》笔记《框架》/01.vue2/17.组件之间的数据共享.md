---
title: 组件之间的数据共享
date: 2022-06-27 11:01:39
permalink: /pages/0c319a/
categories:
  - 《前端》笔记《框架》
  - 1.vue2
tags:
  - 
---
# 一、小范围数据共享
  ## （一）父组件 向 子组件 传递数据
  ### （1）props 自定义属性
  **使用步骤：**
  1、父组件通过自定义属性将数据传递给子组件
  ```html
  <Son :msg="message" :user="userinfo"></Son>
  ```

  2、子组件通过 props 接收父组件传递过来的数据（科普：可以看看 props 高级用法）
  ```js
  props: ['msg', 'user']
  ```

  ## （二）子组件 向 父组件 传递数据
  ### （1）this.$emit()
  **原理：**
  1、自定义事件
  2、方法
  3、this.$emit()

  **使用步骤：**
  父组件：
  1、定义 方法，接收子组件传递过来的数据，并转存到 data 中
  ```js
  getNum(num) {
    this.count = num
  }
  ```

  2、通过 自定义事件，将这个方法传递给子组件
  ```html
  <Son @numchange="getNum"></Son>
  ```

  子组件：
  3、调用 自定义事件，将子组件的数据传递给父组件
  ```js
  // 语法：this.$emit('自定义事件名', 传递的数据)
  this.$emit('numchange', this.num)
  ```

  ### （2）.sync 事件修饰符（推荐，相比 this.$emit()，少了定义方法这一步）
  **应用场景：** 只能修改通过 props 传递将来的数据，也就是父组件向子组件传递的数据

  **原理：**
  1、.sync 事件修饰符
  2、this.$emit()

  1、为自定义属性加上 .sync 事件修饰符（-- 父组件）
  **方法：** `<组件 :自定义属性.sync='修改的数据'>`

  **例：**
  ```html
  <child :show-dialog.sync='showDialog'>
  ```

  2、通过 this.$emit() 修改父组件的数据（-- 子组件）
  **方法：** `this.$emit('update:自定义属性', 值)`

  **例：**
  ```js
  this.$emit('update:showDialog', false)
  ```

  ## （三）父组件 和 子组件 的双向数据同步
  **使用步骤：**

  -- 父组件：
  1、通过 v-bind 和 v-model 将数据传递给父组件

  -- 子组件：
  2、声明 自定义属性
  3、声明 自定义事件（自定义事件名开头的固定格式： updata:属性名，代表双向数据同步）
  4、调用 自定义事件 获取子组件传递过来的数据
  
  ```
    -- 父组件

        <template>
            <div>
                <h1>App 根组件  ---- {{count}}</h1>
                <button @click="count += 1">+1</button>
                <hr />

                // 1、子组件通过 v-bind 和 v-model 将数据传递给父组件
                <my-counter v-model:number="count"></my-counter>

            </div>
        </template>

        <script>
            import MyCounter from './Counter.vue'

            export default {
                name: 'MyApp',
                data() {
                    return {
                        count: 0,
                    }
                },
                components: {
                    MyCounter
                }
            }
        </script>

    -- 子组件
        <template>
            <div>
                <p>count值是：{{number}}</p>
                <button @click="add">+1</button>
            </div>
        </template>

        <script>
            export default {
                name: 'MyCounter',

                // 2、声明 自定义属性
                props: ['number'],

                // 3、声明 自定义事件（自定义事件名开头的固定格式： updata:属性名）
                emits: ['update:number'],

                methods: {
                    add() {

                        // 4、调用 自定义事件 获取子组件传递过来的数据
                        this.$emit('update:number', this.number + 1)

                    }
                }
            }
        </script>
  ```

  ##（四）兄弟组件 之间的数据共享

        方法：EventBus

        mitt 第三方包
            作用：创建 EventBus对象
            下载：npm i mitt@2.1.0

        使用步骤：

            1、创建 eventBus.js，并向外共享 eventBus 实例对象

            数据 接收 方
                2、导入 eventBus.js
                3、在 created 函数中调用 bus.$on 方法声明自定义事件，通过形参获取传递过来的值
                    语法：bus.$on('自定义事件', data => {})
            
            数据 发送 方
                4、导入 eventBus.js
                5、在 created 函数中调用 bus.$emite 触发自定义事件，向外发送数据

        // 1、创建 eventBus.js，并向外共享 eventBus 实例对象
        -- eventBus.js
            import mitt form 'mitt'  // 导入 mitt
            const bus = mitt()  // 创建 eventBus 实例对象
            export default bus  // 向外共享 eventBus 实例对象

        -- 父组件
            <兄弟组件A></兄弟组件A>
            <兄弟组件B></兄弟组件B>

        -- 兄弟组件B（数据接收方）

            // 2、导入 eventBus.js
            import bus from './eventBus.js'

            export default {
                data() {
                    return {
                        msgFromLeft: ''
                    }
                },
                created() {

                    // 3、在 created 函数中调用 bus.$on 声明自定义事件，通过形参获取传递过来的值
                    bus.$on('share', val => {
                        this.msgFromLeft = val
                    })

                }
            }

        -- 兄弟组件A（数据发送方）

            // 4、导入 eventBus.js
            import bus from './eventBus.js'

            export default {
                data() {
                    return {
                        msg: 'hello vue.js'
                    }
                },
                methods: {
                    sendMsg() {

                        // 5、在 created 函数中调用 bus.$emite 触发自定义事件，向外发送数据
                        bus.$emit('share', this.msg)

                    }
                }
            }

    （5）后代组件 之间的数据共享
        原理：provide、inject
        使用步骤：
            
            父组件：
                1、在 provide 函数中定义向后代组件共享的数据
            
            后代组件：
                2、接收父组件共享的数据

        -- 父组件
            
            data() {
                return {
                    color: 'red'
                }
            },
            provide() {
                return {

                    // 1、在 provide 函数中定义向后代组件共享的数据
                    color: this.color

                }
            }

        -- 后代组件

            <h5>后代组件 --- {{color}}</h5>

            // 2、接收父组件共享的数据
            inject: ['color']

    （6）后代组件 之间的 响应式 数据共享
        原理：provide、inject、computed
        使用步骤：
            
            父组件：
                1、导入 vue 中的 computed 方法
                2、在 provide 函数中定义向后代组件共享的数据，并将该数据包装为响应式数据
            
            后代组件：
                3、接收父组件共享的数据
                4、使用父组件共享的数据（必须以 父组件共享的数据.value 的格式使用）

        -- 父组件

            // 1、导入 vue 中的 computed 方法
            import { computed } from 'vue'

            data() {
                return { color: 'red' }
            },
            provide() {
                return {
                    // 2、在 provide 函数中定义向后代组件共享的数据，并将该数据包装为响应式数据
                    color: computed(() => this.color)
                }
            }

        -- 子组件

            // 4、使用父组件共享的数据（必须以 父组件共享的数据.value 的格式使用）
            <h5>后代组件 --- {{color.value}}</h5>

            // 3、接收父组件共享的数据
            inject: ['color']

# 二、小范围方法共享
  ## （一）父组件 向 子组件 传递方法
  ### （1）this.$emit()（推荐）
  **原理：**
  - 自定义事件
  - this.$emit()

  **使用步骤：**
  父组件：
  1、通过 自定义事件，将父组件的方法传递给子组件
  ```html
  <Father @demo="demo"></Father>
  ```

  子组件：
  2、使用 this.$emit() 调用自定义事件
  ```js
  demo() {
    this.$emit('demo')
  },
  ```

  ### （2）this.$parent
  **作用：** 获取父组件的实例

  **说明：** 耦合性太高，必须要知道父属性的方法名是什么，而 this.$emit() 的方式只是通知父组件触发了一个，并不关心实际这个事件的方法叫什么

  **使用步骤：**
  ```js
  -- 子组件

  // 先判断是否用这个方法，再去调用这个方法
  this.$parent.方法 && this.$parent.方法()
  ```


  ## （二）子组件 向 父组件 传递方法
  ### （1）ref
  **作用：** 获取 DOM 元素

  **使用步骤：**
  ```
  -- 父组件：
  1、绑定 ref 获取 DOM 元素
  ```js
  <child ref="childRef"></child>
  ```

  2、通过 this.$refs 调用子组件的方法
  ```js
  this.$refs.childRef.demo()
  ```
            
# 三、大范围数据、方法共享：
  ## （一）Vue 原型
  **使用步骤：**
  1、Vue.prototype.属性名 = 值
  ```js
  Vue.prototype.baseURL='http://www.baidu.com'
  ```

  ## （二）本地存储

  ## （三）vuex

# 四、vuex 模块中的数据共享
  **说明：** 所有模块都加了命名空间

  ## （一）在 A模块 中的 actions 中调用 B模块的 actions
  ### （1）开启 commit 的第三个参数 { root: true }
  `root: true`：调用根级的 mutations 或 actions

  **语法：** `context.commit('B模块/actions 方法', [], { root: true })`
 
  **例：**
  （-- A模块）
  ```js
  const actions = {
    logout(context) {
      context.commit('permission/setRoutes', [], { root: true })
    }
  }
  ```
