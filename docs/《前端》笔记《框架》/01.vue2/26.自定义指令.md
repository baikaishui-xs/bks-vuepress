---
title: 自定义指令
date: 2022-06-27 11:01:39
permalink: /pages/4c6157/
categories:
  - 《前端》笔记《框架》
  - 1.vue2
tags:
  - 
---
    特性：在 vue3 中，bind 名为 mounted 函数，updat 名为 updated 函数，用法和作用都是一样的
    
    bind(el, binding) 函数
        作用：当被绑定的元素渲染到页面后 触发（第一次生效，后面不生效）
        特性：
            1、参数一，当前 指令所绑的 DOM元素
            2、参数二，当前 自定义指令 对象

    updat(el, binding) 函数
        作用：数据变化时 触发（第一次不生效，后面生效）
        特性：
            1、参数一，当前 指令所绑的 DOM元素
            2、参数二，当前 自定义指令 对象
    
    特性：当 bind 和 updat 的函数体完全相同时，可以简写为 函数格式

## 私有自定义指令：只能在定义的组件中使用
    
    使用步骤：
        （1）在 directives 节点中定义 私有自定义指令
        （2）使用 自定义指令

    需求：点击按钮，让 h1 变为红色

    <template>
        <div class="app-container">

            // （2）使用 自定义指令
            <h1 v-color="color">App 根组件</h1>

        </div>
    </template>

    export default {

        // （1）在 directives 节点中定义 私有自定义指令
        // directives：定义 私有自定义指令
        data() {
            return {
                color: 'blue'
            }
        },
        directives: {
            /*  
                color: {
                    bind(el, binding) {

                        // binding.value：获取 自定义指令的值
                        el.style.color = binding.value

                    }，
                    update(el, binding) {
                        el.style.color = binding.value
                    }
                } 
            */
            // 简写：
                color(el, binding) {
                    el.style.color = binding.value
                }
        }

    }

## 全局自定义指令：可以在所有组件中使用
    语法：Vue.directive('指令名', function(el, binding) {函数体})
    使用步骤：在 main.js 的 Vue.directive方法 中定义
    特性：和 私有自定义指令相同

    -- main.js
    /*
        Vue.directive('color', {
            bind(el, binding) {
                el.style.color = binding.value
            }，
            update(el, binding) {
                el.style.color = binding.value
            }
        })
    */

    // 简写：
        Vue.directive('color', (el, binding) => {
            el.style.color = binding.value
        })

## 应用场景
  ### （一）解决图片有地址，但是没有加载成功的问题
  **解决方法：** 设置图片异常的默认图片

  **原理：**
  1、自定义指令
  2、onerror 事件

  #### 使用步骤
  ##### （1）定义自定义指令（-- @/src/新建 directives/index.js）
  ```js
  export const imageError = {
    inserted(dom, options) { // inserted 钩子函数：当前 dom 元素插入到节点之后执行
      dom.src = dom.src || options.value
      dom.onerror = function() { // onerror 事件：图片有地址，但是没有加载成功触发
      dom.src = options.value
      }
    },
    componentUpdated(dom, options) { // componentUpdated 钩子函数：当前 dom 元素更新数据后执行
      dom.src = dom.src || options.value
    }
  }
  ```

  ##### （2）全局引入自定义指令（-- @/main.js）
  ```js
  import * as directives from '@/directives'
  ```

  ##### （3）注册自定义组件（-- 同上）
  ```js
  Object.keys(directives).forEach(key => {
    Vue.directive(key, directives[key])
  })
  ```

  ##### （4）定义默认图片（-- 组件）
  ```js
  data() {
    return {
        defaultImg: require('@/assets/common/head.jpg') // 考虑到打包时，路径会发送变化，导致图片加载失败。所以这里使用 require 包裹起来
    }
  }
  ```

  ##### （5）绑定自定义指令（-- 同上）
  ```js
  <img v-imageError="defaultImg">
  ```