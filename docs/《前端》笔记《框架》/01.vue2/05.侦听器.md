---
title: 侦听器
date: 2022-06-27 11:01:39
permalink: /pages/ee2297/
categories:
  - 《前端》笔记《框架》
  - 1.vue2
tags:
  - 
---
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Document</title>
</head>

<body>
  <!-- 知识点：侦听器
    作用：监听 data 中的数据，当 data 中的数据发送变化时触发
    使用步骤：在 watch 对象中定义侦听器
    语法：数据名(newVal, oldVal) {}
      newVal：变化后的新值    oldVal：变化前的旧值
    应用场景：表单验证
  -->
  <div id="app">
    <input type="text" v-model="username" />
    <input type="text" v-model="info.username" />
  </div>

  <script src="sucai/vue-2.6.12.js"></script>
  <script src="sucai/jquery-v3.6.0.js"></script>

  <script>
    const vm = new Vue({
      el: '#app',
      data: {
        username: 'admin',
        info: {
          username: 'zhangsan',
        },
      },

      // watch：定义侦听器
      watch: {
        // // 格式一：函数
        // // 特性：
        // // 1、页面加载后，不会 自动触发
        // // 2、无法 侦听对象中的属性
        // username(newVal, oldVal) {
        //   console.log('变化后的新值：' + newVal + ' 变化前的旧值：' + oldVal);

        //   // 不能请求空的参数，会报错，所以要加判断
        //   if (newVal === '') return

        //   // 调用 jQuery 中的 Ajax 发起请求，判断 newVal 是否被占用
        //   $.get('https://www.escook.cn/api/finduser/' + newVal, function (result) {
        //     console.log(result)
        //   })

        // },

        // 格式二：对象
        // 特性：
        // 1、页面加载后，会 自动触发
        // 2、侦听对象中的某个属性（深度侦听）
        // immediate：自动触发侦听器。 true：是    false（默认）：否

        // deep：是否开启深度侦听。  true：开启    false（默认）：不开启
        // 应用场景：监听对象中 多个 属性

        username: {
          handler(newVal, oldVal) {
            $.get('https://www.escook.cn/api/finduser/' + newVal, function (result) {
              console.log(result)
            })
          },
          immediate: true,
        },

        // info: {
        //     handler(newVal, oldVal) {
        //         console.log(newVal.username);
        //     },
        //     deep: true
        // },

        // 深度侦听 简写：
        'info.username': {
          handler(newVal, oldVal) {
            console.log(newVal)
          },
        },

        // info.监听的属性
        // 应用场景：监听对象中 单个 属性
        /*
          data() {
            return {
              info: { username: 'admin', password: '' },
            }
          },
          watch: {
            'info.username': {
              async handler(newVal, oldVal) {
                const { data: res } = await axios.get('https://www.escook.cn/api/finduser/$(newVal}')
                console.log(res)
              }
            }
          }
        */
      },
    })
  </script>
</body>

</html>

<!-- 例子：检测当前输入的用户名是否可用
  
  import axios from 'axios'
  export default {
    data() {
      return { username: '' }
    },
    watch: {
      async username(newVal, oldVal) {
        const { data: res } = await axios.get('https://www.escook.cn/api/finduser/${newVal}')
        console.log(res)
      }
    }
  }

-->