---
title: 导航守卫
date: 2022-06-27 11:01:39
permalink: /pages/b55487/
categories:
  - 《前端》笔记《框架》
  - 1.vue2
tags:
  - 
---
作用：控制路由的访问权限
触发条件：每次发生路由的导航跳转，都会触发导航守卫

应用场景：登录功能
  - 用户 没有登录 时，跳转到 登录 页面
  - 用户 登录 时，跳转到 用户 页面

全局前置守卫
  前置：将要做某件事情时
  使用步骤：
    // 创建全局前置守卫
      // 特性：router.beforeEach 方法内必须传递一个函数，这个函数也被称为 方法守卫
      router.beforeEach((to, from, next) => {
        // 方法守卫的三个形参：
          // to：将要 访问 路由的信息对象（path：将要访问的路由地址）
          // from：将要 离开 路由的信息对象
          // next：是一个函数，表示放行，允许这次路由导航
            // 特性：
              // 1、不声明 next 形参，则默认允许用户访问每一个路由！
              // 2、声明了 next 形参，则必须调用 next() 函数，否则不允许用户访问任何一个路由！
            // next 的三种用法：
              // 1、直接放行：next()
              // 2、强制跳转到指定页面：next('Hash地址')
              // 3、不允许跳转：next(false)

        console.log(from.params)    // {mdi: "1"}
        console.log(from.path)    // "movie/1"
      })
    
需求：点击按钮访问后台主页，如果用户登录，跳转到后台主业，用户没有登录则跳转到登录界面
  -- Home 组件
  <template>
    <div>
      <router-link to="/main">访问后台主页</router-link>
    </div>
  </template>

  -- Main 组件
  <template>
    <div>
      <h3>后台主页</h3>
    </div>
  </template>

  -- Login 组件
  <template>
    <h3>登录页面</h3>
  </template>

  -- index.js

    // （1）导入路由
    import Login from '@/components/Login.vue'
    import Main from '@/components/Main.vue'

    const router = new VueRouter({
      routes: [

        // （2）定义路由规则
        { path: '/login', component: Login },
        { path: '/main', component: Main }

      ]
    })
    
    // （3）创建全局前置守卫
    router.beforeEach(function(to, from, next) {

      // 判断是否 访问后台主页
      if (to.path === '/main') {

        // localStorage.getItem：获取 token 值
        const token = localStorage.getItem('token')

        // 判断是否 携带 token值
        if (token) {
          next()
        } else {
          next('/login')
        }

      } else {

        // 访问其它导航时，直接放行
        next()
      }
    })

例：
```js
router.beforeEach(function (to, from, next) {
  if (to.path === '/login') return next()
  if (to.path === '/home') return next()

  const tokenStr = window.sessionStorage.getItem('token')
  if (!tokenStr) return next('/login')
  next()
})
```