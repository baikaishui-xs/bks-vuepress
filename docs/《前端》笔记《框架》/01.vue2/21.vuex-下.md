---
title: vuex（下）
date: 2022-06-27 11:01:39
permalink: /pages/27c1f4/
categories:
  - 《前端》笔记《框架》
  - 1.vue2
tags:
  - 
---
作用：让 vuex 中管理的状态数据存储在本地，解决页面刷新数据丢失的问题

说明：因为数据是存储在内存中的，所以刷新后数据就重置了

使用方法：
  测试：
    1、页面刷新后数据没有丢失，则持久化成功
    2、查看存储的数据：控制台 → Application → Local Storage → http://localhost:8080 → 本地仓库名字

  安装
    npm i vuex-persistedstate@4.1.0

  在 store/modules 下创建 user.js 文件
      // 用户模块
      export default {
        namespaced: true,
        state () {
          return {
            // 用户信息
            profile: {  // 存储
              id: '',
              avatar: '',  // 头像
              nickname: '',  // 昵称
              account: '',  // 账号名
              mobile: '',  // 手机号
              token: ''
            },
          }
        },
        mutations: {  // 修用户信息
          // 修改用户信息，payload 就是用户信息对象
          setUser (state, payload) {
            state.profile = payload
          },
          // 修改回跳地址
          setRedirectUrl (state, url) {
            state.redirectUrl = url
          }
        }
      }

    引入模块（-- store/index.js）
      import createPersistedState from 'vuex-persistedstate'  // （1）引入 vuex-persistedstate
      import user from './modules/user'

      export default createStore({
        modules: {
          user
        },
        plugins: [
          createPersistedState({
            // （2）配置插件
            key: 'store', // 本地仓库名字
            paths: ['user'] // 指定需要持久化的模块
          })
        ]
      })

    （-- App.vue）
    <template>
      <div class="container">
        App {{ $store.state.user.profile.account }}
        <button @click="$store.commit('user/setUser', {account: 'zhousg'})">设置用户信息</button>
      </div>
    </template>