---
title: 组件之间的数据共享
date: 2022-06-27 11:01:39
permalink: /pages/1e42a3/
categories:
  - 《前端》笔记《框架》
  - vue3
tags:
  - 
---
（1）父组件 向 子组件 传递数据
  使用步骤：
    1、父组件通过 v-bind 将数据传递给子组件
    2、子组件通过 props 接收父组件传递过来的数据
    3、使用 setup 参数将数据传递到 setup 中

  --父组件

    <template>
      <div class="container">
        <h1>父组件</h1>
        <p>{{money}}</p>
        <hr>
        <Son :money="money" />  // 1、父组件通过 v-bind 将数据传递给子组件
      </div>
    </template>
    <script>
      import { ref } from 'vue'
      import Son from './Son.vue'
      export default {
        name: 'App',
        components: {
          Son
        },
        setup () {
          const money = ref(100)
          return { money }
        }
      }
    </script>


  -- 子组件

    <template>
      <div class="container">
        <h1>子组件</h1>
        <p>{{money}}</p>
      </div>
    </template>
    <script>
      import { onMounted } from 'vue'
      export default {
        name: 'Son',
        props: {  // 2、子组件通过 props 接收父组件传递过来的数据
          money: {
            type: Number,
            default: 0
          }
        },
        setup (props) {  // 3、使用 setup 参数将数据传递到 setup 中
          console.log(props.money)
        }
      }
    </script>

（2）子组件 向 父组件 传递数据
  使用步骤：

    子组件：
      1、解构 emit 方法
      2、定义一个方法，第一个参数传递自定义事件名
      3、将这个方法 return 出去

    父组件：
      4、绑定自定义事件
      5、使用自定义事件中的 参数，接收子组件传递过来的数据

  -- 子组件

    <template>
      <div class="container">
        <h1>子组件</h1>
        <p>{{money}}</p>
        <button @click="changeMoney">花50元</button>
      </div>
    </template>
    <script>
      import { onMounted } from 'vue'
      export default {
        name: 'Son',
        setup (props, {emit}) {  // 1、解构 emit 方法
            const changeMoney = () => {  // 2、定义一个方法，第一个参数传递自定义事件名
              emit('change-money', 50)
            }
          return {changeMoney}  // 3、将这个方法 return 出去
        }
      }
    </script>

  -- 父组件

    <template>
      <div class="container">
        <h1>父组件</h1>
        <p>{{money}}</p>
        <hr>

        // <Son :money="money" @change-money="updateMoney" />  // 4、绑定自定义事件
        <Son v-money:money="money" />  // 简写

      </div>
    </template>
    <script>
      import { ref } from 'vue'
      import Son from './Son.vue'
      export default {
        name: 'App',
        components: {
          Son
        },
        setup () {
          const money = ref(100)
          const updateMoney = (newMoney) => {  5、使用自定义事件中的参数，接收子组件传递过来的数据
            money.value = newMoney
          }
          return { money , updateMoney}
        }
      }
    </script>

（3）父组件 和 子组件 的双向数据同步
  使用步骤：

    子组件：
      1、解构 emit 方法
      2、定义一个方法， 调用 emit，第一个参数传递 update:数据
      3、将这个方法 return 出去

    父组件：
      4、使用 update:数据 绑定自定义事件
      5、使用自定义事件中的参数，接收子组件传递过来的数据

  -- 子组件

    <template>
      <div class="container">
        <h1>子组件</h1>
        <p>{{money}}</p>
        <button @click="changeMoney">花50元</button>
      </div>
    </template>
    <script>
      import { onMounted } from 'vue'
      export default {
        name: 'Son',
        setup (props, {emit}) {  // 1、解构 emit 方法
            const changeMoney = () => {  // 2、定义一个方法， 调用 emit，第一个参数传递 update:数据 
              emit('update:money', 50)
            }
          return {changeMoney}  // 3、将这个方法 return 出去
        }
      }
    </script>

  -- 父组件

    <template>
      <div class="container">
        <h1>父组件</h1>
        <p>{{money}}</p>
        <hr>
        <Son :money="money" @update:money="updateMoney" />  // 4、使用 update:数据 绑定自定义事件
      </div>
    </template>
    <script>
      import { ref } from 'vue'
      import Son from './Son.vue'
      export default {
        name: 'App',
        components: {
          Son
        },
        setup () {
          const money = ref(100)
          const updateMoney = (newMoney) => {  5、使用自定义事件中的参数，接收子组件传递过来的数据
            money.value = newMoney
          }
          return { money , updateMoney}
        }
      }
    </script>

（4）后代组件 之间的数据共享
  原理：provide、inject
  使用步骤：
    1-1、使用 provide 方法将数据共享给后代组件
    1-2、使用 inject 方法接收祖先组件提供的数据
  特性：后代组件不能直接修改共享的数据，应该遵循单项数据流原则，也就是谁定义谁修改原则，如果有后代组件要修改共享数据的需求，应该通知祖先组件，让祖先组件取修改
    使用步骤：
      父组件：
        2-1、定义修改共享数据的方法
        2-2、将这个方法共享出去
      后代组件：
        2-3、接收方法
        2-4、调用方法

  -- 父组件

    <template>
      <div class="container">
        <h1>父组件 {{money}} <button @click="money=1000">发钱</button></h1>
        <hr>
        <Son />
      </div>
    </template>
    <script>
      import { provide, ref } from 'vue'
      import Son from './Son.vue'
      export default {
        name: 'App',
        components: {
          Son
        },
        setup () {
          const money = ref(100)
          const changeMoney = (saleMoney) => {  // 2-1、定义修改共享数据的方法
            console.log('changeMoney',saleMoney)
            money.value = money.value - saleMoney
          }

          // 语法：provide('标识符', 共享的数据) 
          provide('money', money)  // 1-1、使用 provide 方法将数据共享给后代组件
          provide('changeMoney', changeMoney)  // 2-2、将这个方法共享出去

          return { money }
        }
      }
    </script>

  -- 子组件

    <template>
      <div class="container">
        <h2>子组件 {{money}}</h2>
        <hr>
        <GrandSon />
      </div>
    </template>
    <script>
      import { inject } from 'vue'
      import GrandSon from './GrandSon.vue'
      export default {
        name: 'Son',
        components: {
          GrandSon
        },
        setup () {
          const money = inject('money')  // 1-2、使用 inject 方法接收祖先组件提供的数据
          return { money }
        }
      }
    </script>

  -- 后代组件

    <template>
      <div class="container">
        <h3>孙组件 {{money}} <button @click="fn">消费20</button></h3>  // 2-4、调用方法
      </div>
    </template>
    <script>
      import { inject } from 'vue'
      export default {
        name: 'GrandSon',
        setup () {
          const money = inject('money')  // 1-2、使用 inject 方法接收祖先组件提供的数据
          const changeMoney = inject('changeMoney')  // 2-3、接收方法
          const fn = () => {
            changeMoney(20)
          }
          return {money, fn}
        }
      }
    </script>